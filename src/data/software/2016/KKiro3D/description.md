# KKiro3D

## editor.html

![editor.html](images/1)

에디터를 켜면 이런 화면이 나타납니다.

좌측 상단에는 장면 로드나 저장, 멀티플레이어 접속/접속 해제를 할 수 있는 메뉴가 나타나고 우측 상단에는 게임을 일시 정지하는 버튼과 멀티플레이어 접속이 된 경우 연결 상태와 접속자 수가 나타납니다. 또한 중앙에는 실제 게임 오브젝트들을 편집할 수 있는 3D 뷰가 나타나고 우측에는 Outline과 Properties 메뉴가 나타납니다.

## 메인 메뉴

![메인 메뉴](images/2)

메인 메뉴에는 File과 Network 카테고리가 있습니다.

File을 누르면 다음과 같은 항목이 나타납니다.

- New: 비어있는 장면을 불러옵니다.
- Load JSON...: JSON을 직접 입력해서 장면을 불러올 수 있습니다. Upload... 를 누르면 파일을 열어 장면을 불러올 수도 있습니다.
- Export JSON...: 현재 불러온 장면을 JSON으로 출력합니다. Download... 를 누르면 파일로 저장할 수도 있습니다.
- Load Entity...: 장면에 엔티티 JSON을 불러옵니다. Upload... 를 누르면 파일을 열어 불러올 수도 있습니다.
- Load from LocalStorage: 브라우저 쿠키로부터 장면을 불러옵니다.
- Save to LocalStorage: 브라우저 쿠키로 장면을 저장합니다. 쿠키를 사용해서 브라우저가 닫혀도 데이터가 계속 남아있습니다.

Network를 누르면 다음과 같은 항목이 나타납니다.

- Connect...: 서버의 주소를 입력받아서 해당 서버로 접속합니다.
- Disconnect: 서버와의 연결을 종료합니다.

## 우측 상단 메뉴

![우측 상단 메뉴](images/3)

우측 상단에는 게임을 일시정지하는 버튼과 멀티플레이 접속이 된 경우 연결 상태와 접속자 수가 나타납니다. 연결이 실패한 경우 붉은색 X가 표시되며, 싱글플레이 모드인 경우 표시되지 않습니다.

## 3D 뷰어

![3D 뷰어](images/4)

실제로 게임을 편집할 수 있는 화면으로, 게임 오브젝트들이 표시됩니다. 블렌더와 비슷한 단축키와 조작법을 채택하고 있습니다.

- 우클릭을 통해서 개체를 선택할 수 있습니다. 우클릭 후 드래그를 하면 축에 고정되지 않고 개체를 이동할 수 있습니다.
- 좌클릭을 통해서 3D 커서를 설정할 수 있습니다. 3D 커서는 개체 위에 고정되며, 엔티티가 추가될 때 기본 위치로 설정됩니다. 좌클릭으로 축(화살표)을 드래그하면 해당 방향으로 개체를 이동할 수 있습니다.
- 마우스 휠을 돌려서 확대율을 변경할 수 있습니다. 휠을 누르고 마우스를 드래그해서 카메라를 회전합니다.
- 숫자 키패드의 1, 3, 7 키를 눌러서 해당 방향으로 카메라를 돌릴 수 있습니다.
- 숫자 키패드의 5 키를 눌러서 perspective / orthographic 모드를 전환할 수 있습니다.
- 키보드의 스페이스바키를 눌러 카메라를 중앙으로 옮길 수 있습니다.

## 3D 커서

![3D 커서](images/5)

## 개체 선택

![개체 선택](images/6)

개체가 선택되면 오렌지색으로 외곽선이 표시되며, 중앙에 각 축을 나타내는 화살표가 표시됩니다. 이 화살표를 드래그해서 해당 방향으로 움직일 수 있습니다. 다른 플레이어가 선택한 개체는 파란색으로 빛나고, 다른 플레이어의 카메라는 초록색으로 빛납니다.

## 위젯

![위젯](images/7)

## Camera

![Camera](images/8)

카메라는 선택하면 Near / Far 값도 반영되어 카메라의 Frustum 전체가 보이게 됩니다. 이는 섀도우 매핑 영역을 지정할 때 유용합니다.

## SpotLight

![SpotLight](images/9)

## Outline

![Outline](images/10)

## Properties

![Properties](images/11)

## index.html

![index.html](images/12)

실제 게임이 실행되는 화면입니다. 테스트용으로 마인크래프트와 비슷하게 블럭을 설치하고 제거할 수 있는 게임을 만들었습니다.

키보드의 W, A, S, D 이 4키로 이동을 하고 스페이스바키로 점프합니다. 또한 마우스 좌클릭으로 블럭을 파괴하고 우클릭으로 블럭을 설치합니다. 또한 마우스의 휠을 돌려서 설치할 블럭을 변경할 수 있습니다.

## ECS 프레임워크

KKiro3D는 Entity-Component-System 구조와 시그널을 사용합니다.

<https://github.com/yoo2001818/fudge>

### 시그널

시그널은 데이터 변경과 같이 특정한 일이 발생할 때 발동되는 이벤트 리스너입니다. KKiro3D에서는 모든 데이터 변경을 시그널을 사양하도록 해 시스템 개발을 손쉽게 할 수 있게 합니다.

KKiro3D의 시그널은 일반적인 시그널과는 달리 단계와 핸들러와 부모가 존재합니다. 이를 사용해서 명령을 취소하거나 변경하는 걸 손쉽게 구현할 수 있고, 데이터 변경을 시그널을 통해 간편하게 호출할 수 있게 합니다.